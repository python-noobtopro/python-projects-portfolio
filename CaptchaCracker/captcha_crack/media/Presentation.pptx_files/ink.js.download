var ink=function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e),n.d(e,"inkCanvasFactoryGlobal",(function(){return Ve})),n.d(e,"inkStrokeRasterizerFactoryGlobal",(function(){return $e})),n.d(e,"inkDryStoreFactoryGlobal",(function(){return hn}));var i,o={logActivity:function(t,e,n,i){}};function r(){return-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident")}function s(){return-1!==navigator.userAgent.indexOf("Firefox")}function u(){return!r()&&(t="mix-blend-mode",e="darken",void 0!==window.CSS&&window.CSS.supports(t,e));var t,e}function a(t){t.style.pointerEvents="auto"}function h(t){t.style.pointerEvents="none"}function c(t){return new HapticsPredefinedWaveform(t)}!function(t){t[t.WAVEFORM_CLICK=4099]="WAVEFORM_CLICK",t[t.WAVEFORM_BUZZ_CONTINUOUS=4100]="WAVEFORM_BUZZ_CONTINUOUS",t[t.WAVEFORM_RUMBLE_CONTINUOUS=4101]="WAVEFORM_RUMBLE_CONTINUOUS",t[t.WAVEFORM_PRESS=4102]="WAVEFORM_PRESS",t[t.WAVEFORM_RELEASE=4103]="WAVEFORM_RELEASE",t[t.WAVEFORM_HOVER=4104]="WAVEFORM_HOVER",t[t.WAVEFORM_SUCCESS=4105]="WAVEFORM_SUCCESS",t[t.WAVEFORM_ERROR=4106]="WAVEFORM_ERROR",t[t.WAVEFORM_INK_CONTINUOUS=4107]="WAVEFORM_INK_CONTINUOUS",t[t.WAVEFORM_PENCIL_CONTINUOUTS=4108]="WAVEFORM_PENCIL_CONTINUOUTS",t[t.WAVEFORM_MARKER_CONTINUOUS=4109]="WAVEFORM_MARKER_CONTINUOUS",t[t.WAVEFORM_CHISEL_MARKER_CONTINUOUS=4110]="WAVEFORM_CHISEL_MARKER_CONTINUOUS",t[t.WAVEFORM_BRUSH_CONTINUOUS=4111]="WAVEFORM_BRUSH_CONTINUOUS",t[t.WAVEFORM_ERASER_CONTINUOUS=4112]="WAVEFORM_ERASER_CONTINUOUS",t[t.WAVEFORM_FIRST_CUSTOM_VENDOR_DEFINED=10752]="WAVEFORM_FIRST_CUSTOM_VENDOR_DEFINED",t[t.WAVEFORM_SECOND_CUSTOM_VENDOR_DEFINED=8479]="WAVEFORM_SECOND_CUSTOM_VENDOR_DEFINED",t[t.WAVEFORM_GALAXY_PEN_CONTINUOUS=4113]="WAVEFORM_GALAXY_PEN_CONTINUOUS"}(i||(i={}));var p=function(){function t(){this.isPointerDown=!1}return t.prototype.play=function(t){if(void 0!==this.haptics){var e=t();void 0!==e&&this.haptics.play(e)}},t.prototype.stop=function(){var t;null===(t=this.haptics)||void 0===t||t.stop()},t.prototype.onPointerDown=function(t){var e;this.isPointerDown=!0,this.extractHapticsDevice(t),null===(e=this.output)||void 0===e||e.onPointerDown(t)},t.prototype.onPointerMove=function(t){var e;this.extractHapticsDevice(t),null===(e=this.output)||void 0===e||e.onPointerMove(t)},t.prototype.onPointerUp=function(t){var e;this.isPointerDown=!1,this.extractHapticsDevice(t),null===(e=this.output)||void 0===e||e.onPointerUp(t)},t.prototype.extractHapticsDevice=function(t){var e;this.haptics=null!==(e=t.haptics)&&void 0!==e?e:void 0},t}(),d={r:0,g:0,b:0,a:1},l={r:255,g:255,b:255,a:1};function f(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}var y=function(){function t(t){this.color=f(void 0!==t?t:d)}return t.prototype.setRed=function(t){return this.color.r=t,this},t.prototype.setGreen=function(t){return this.color.g=t,this},t.prototype.setBlue=function(t){return this.color.b=t,this},t.prototype.setAlpha=function(t){return this.color.a=t,this},t.prototype.setHexRGB=function(t){return 7===t.length&&"#"===t[0]&&(this.color.r=parseInt(t.substr(1,2),16),this.color.g=parseInt(t.substr(3,2),16),this.color.b=parseInt(t.substr(5,2),16)),this},t.prototype.build=function(){return f(this.color)},t}(),v={type:0},g={width:4,height:4,color:d,effect:v,tip:"ellipse",rasterOperation:"copy"};function m(t){return{width:t.width,height:t.height,color:t.color,effect:t.effect,tip:t.tip,rasterOperation:t.rasterOperation}}var w,P=function(){function t(t){this.attributes=m(void 0!==t?t:g)}return t.prototype.setWidth=function(t){return this.attributes.width=t,this},t.prototype.setHeight=function(t){return this.attributes.height=t,this},t.prototype.setColor=function(t){return this.attributes.color=t,this},t.prototype.setEffect=function(t){return this.attributes.effect=t,this},t.prototype.setTip=function(t){return this.attributes.tip=t,this},t.prototype.setRasterOperation=function(t){return this.attributes.rasterOperation=t,this},t.prototype.build=function(){return m(this.attributes)},t}(),S=!1,k=function(){function t(t,e){var n=this;this.penType="pen",this.cachedPenTimeInSec=0,this.lastPenInSec=0,this.onUnload=function(){clearInterval(n.logIntervalId),n.logPenUsage()},this.countDistinctSecond=function(t){if(t.pointerType===n.penType){var e=Math.floor(Date.now()/1e3);e>n.lastPenInSec&&(n.cachedPenTimeInSec+=1,n.lastPenInSec=e)}},this.logger=t,this.registerPenEvents();var i=void 0!==e?e:1;this.logIntervalId=window.setInterval(this.logPenUsage.bind(this),60*i*1e3)}return t.prototype.registerPenEvents=function(){window.addEventListener("pointerover",this.countDistinctSecond,!0),window.addEventListener("pointerdown",this.countDistinctSecond,!0),window.addEventListener("pointermove",this.countDistinctSecond,!0),window.addEventListener("pointerup",this.countDistinctSecond,!0),window.addEventListener("beforeunload",this.onUnload)},t.prototype.logPenUsage=function(){0!==this.cachedPenTimeInSec&&(this.logger.logActivity("PenMinutes",1e3*this.cachedPenTimeInSec,["PenInputSec"],[this.cachedPenTimeInSec]),this.cachedPenTimeInSec=0)},t}();!function(t){t.Pen="pen",t.Pencil="pencil",t.Highlighter="highlighter",t.Erase="erase",t.ActionPen="actionPen",t.Laser="laser",t.Lasso="lasso",t.RemoteInk="remoteInk"}(w||(w={}));var x=function(){function t(t,e){var n=this;this.penType="pen",this.mouseType="mouse",this.remoteInputType="unknown",this.logDataNames=["InputType","Activity","InkSec"],this.inkLogName="InkMinutes",this.cachedInkTimeInSec=0,this.cachedRemoteInkTimeInSec=0,this.cachedInkStartTime=0,this.lastInkInSec=0,this.isPointerDown=!1,this.isEventRegistered=!1,this.onPointerDown=function(t){void 0!==n.lastActivity&&(n.countDistinctSecond(t.pointerType),n.isPointerDown=!0)},this.onPointerMove=function(t){void 0!==n.lastActivity&&(void 0===n.lastInputType&&(n.lastInputType=t.pointerType),n.shouldCountPointerMove(t)&&n.countDistinctSecond(t.pointerType))},this.onPointerUp=function(t){void 0!==n.lastActivity&&(n.countDistinctSecond(t.pointerType),n.isPointerDown=!1,n.setLocalInkLogTimerHandle(window.setTimeout(n.logLocalInkMinute,1e3*n.logIntervalInSec)))},this.beforeUnload=function(){n.logLocalInkMinute(),n.resetLocalInkCache(),n.logRemoteInkMinute()},this.logLocalInkMinute=function(){if(0!==n.cachedInkTimeInSec)if(void 0!==n.lastActivity&&void 0!==n.lastInputType){var t=[n.lastInputType,n.lastActivity,n.cachedInkTimeInSec];n.logger.logActivity(n.inkLogName,1e3*n.cachedInkTimeInSec,n.logDataNames,t),n.cachedInkTimeInSec=0}else n.cachedInkTimeInSec=0},this.logRemoteInkMinute=function(){if(0!==n.cachedRemoteInkTimeInSec){var t=[n.remoteInputType,w.RemoteInk,n.cachedRemoteInkTimeInSec];n.logger.logActivity(n.inkLogName,1e3*n.cachedRemoteInkTimeInSec,n.logDataNames,t),n.cachedRemoteInkTimeInSec=0}},this.logger=t,this.logIntervalInSec=60*(void 0===e?1:e)}return t.prototype.activate=function(t){this.isEventRegistered&&this.unregisterEvents(),this.wetCanvas=t,this.registerEvents()},t.prototype.deactivate=function(){this.isEventRegistered&&this.unregisterEvents(),this.logLocalInkMinute(),this.logRemoteInkMinute()},t.prototype.start=function(t){this.lastActivity!==t&&(void 0!==this.lastActivity&&this.end(),this.lastActivity=t)},t.prototype.end=function(){this.logLocalInkMinute(),this.resetLocalInkCache()},t.prototype.onRemoteWetStart=function(){this.countRemoteWetTime(!1)},t.prototype.onRemoteWetAppend=function(){this.countRemoteWetTime(!1)},t.prototype.onRemoteWetEnd=function(){this.countRemoteWetTime(!0)},t.prototype.onRemoteLaserStart=function(t){this.isPointerDown||1!==t&&2!==t||this.countDistinctSecond(this.remoteInputType)},t.prototype.onRemoteLaserMove=function(t){this.isPointerDown||(1!==t&&2!==t||this.countDistinctSecond(this.remoteInputType),1===t&&this.cachedRemoteInkTimeInSec>this.logIntervalInSec&&this.logRemoteInkMinute())},t.prototype.onRemoteLaserEnd=function(){this.isPointerDown||(this.countDistinctSecond(this.remoteInputType),this.setRemoteInkLogTimerHandle(window.setTimeout(this.logRemoteInkMinute,1e3*this.logIntervalInSec)))},t.prototype.setLocalInkLogTimerHandle=function(t){void 0!==this.localInkLogTimerHandle&&window.clearTimeout(this.localInkLogTimerHandle),this.localInkLogTimerHandle=t},t.prototype.resetLocalInkCache=function(){this.lastActivity=void 0,this.lastInputType=void 0},t.prototype.registerEvents=function(){this.wetCanvas.addEventListener("pointerdown",this.onPointerDown,!0),this.wetCanvas.addEventListener("pointermove",this.onPointerMove,!0),this.wetCanvas.addEventListener("pointerup",this.onPointerUp,!0),this.wetCanvas.addEventListener("beforeunload",this.beforeUnload),this.isEventRegistered=!0},t.prototype.unregisterEvents=function(){this.wetCanvas.removeEventListener("pointerdown",this.onPointerDown,!0),this.wetCanvas.removeEventListener("pointermove",this.onPointerMove,!0),this.wetCanvas.removeEventListener("pointerup",this.onPointerUp,!0),this.wetCanvas.removeEventListener("beforeunload",this.beforeUnload),this.isEventRegistered=!1},t.prototype.shouldCountPointerMove=function(t){return this.lastActivity===w.Laser&&this.mouseType===t.pointerType&&this.mouseType===this.lastInputType||(!!this.isPointerDown||this.penType===t.pointerType&&this.penType===this.lastInputType)},t.prototype.countDistinctSecond=function(t){var e=Math.floor(Date.now()/1e3);if(e>this.lastInkInSec){if(t===this.remoteInputType)return this.cachedRemoteInkTimeInSec+=1,void(this.lastInkInSec=e);this.lastInputType!==t?(void 0!==this.lastInputType&&this.logLocalInkMinute(),this.lastInputType=t,this.cachedInkTimeInSec=1):this.cachedInkTimeInSec+=1,this.lastInkInSec=e,1===this.cachedInkTimeInSec&&(this.cachedInkStartTime=this.lastInkInSec),this.lastInkInSec-this.cachedInkStartTime>this.logIntervalInSec&&this.logLocalInkMinute()}},t.prototype.countRemoteWetTime=function(t){this.isPointerDown||(this.countDistinctSecond(this.remoteInputType),t&&this.setRemoteInkLogTimerHandle(window.setTimeout(this.logRemoteInkMinute,1e3*this.logIntervalInSec)))},t.prototype.setRemoteInkLogTimerHandle=function(t){void 0!==this.remoteInkLogTimerHandle&&window.clearTimeout(this.remoteInkLogTimerHandle),this.remoteInkLogTimerHandle=t},t}();function b(t){return document.createElement(t)}function T(){return b("canvas")}function E(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function M(){return E("svg")}var I={info:function(){}};function O(t,e){t.output=e}function C(t,e,n){O(t,e),O(e,n)}function A(t,e,n,i){O(t,e),C(e,n,i)}function D(t){return{x:t.offsetX,y:t.offsetY,pressure:t.pressure,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timeStamp}}function R(t){return{x:t.offsetX,y:t.offsetY,pressure:.5,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timeStamp}}var L=function(){function t(){}return t.prototype.onPointerDown=function(t){this.output.beginStroke(R(t))},t.prototype.onPointerMove=function(t){this.output.addPoint(R(t))},t.prototype.onPointerUp=function(t){this.output.endStroke(R(t))},t}(),N=function(){function t(){}return t.prototype.onPointerDown=function(t){this.output.beginStroke(D(t))},t.prototype.onPointerMove=function(t){this.output.addPoint(D(t))},t.prototype.onPointerUp=function(t){this.output.endStroke(D(t))},t}();function U(){return s()?new L:new N}var H=function(){function t(){}return t.prototype.beginStroke=function(t){this.output.beginStroke(t),this.point=t},t.prototype.addPoint=function(t){this.point.x===t.x&&this.point.y===t.y||(this.output.addPoint(t),this.point=t)},t.prototype.endStroke=function(t){this.output.endStroke(t)},t}(),_=function(){function t(){}return t.prototype.beginStroke=function(t){this.out1={x:t.x,y:t.y},this.out2=this.out1,this.output.beginStroke(t)},t.prototype.addPoint=function(t){this.output.addPoint(this.filter(t))},t.prototype.endStroke=function(t){this.output.endStroke(this.filter(t))},t.prototype.filter=function(t){var e={x:W(t.x,this.out1.x,this.out2.x),y:W(t.y,this.out1.y,this.out2.y)};return this.out2=this.out1,this.out1=e,{x:e.x,y:e.y,pressure:t.pressure,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timestamp}},t}();function W(t,e,n){return(1-1.33- -.5)*t+1.33*e+-.5*n}function X(t,e,n,i){var o=(t+e)/2,r=(e+n)/2,s=(n+i)/2,u=(o+r)/2,a=(r+s)/2;return[t,o,u,(u+a)/2,a,s,i]}function V(t,e,n,i){return[(n-t)/6+e,(e-i)/6+n]}var Y=function(){function t(){this.began=!1}return t.prototype.beginStroke=function(t){this.output.beginStroke(t),this.cp=[t,t,t,t],this.began=!0},t.prototype.addPoint=function(t){var e=this.push(t),n=e[0],i=e[1];this.began?this.began=!1:this.output.addSegment(n,i,this.cp[2])},t.prototype.endStroke=function(t){this.addPoint(t);var e=this.push(t),n=e[0],i=e[1];this.output.endStroke(n,i,this.cp[2])},t.prototype.push=function(t){return this.cp.shift(),this.cp.push(t),e=this.cp[0],n=this.cp[1],i=this.cp[2],o=this.cp[3],r=V(e.x,n.x,i.x,o.x),s=r[0],u=r[1],a=V(e.y,n.y,i.y,o.y),h=a[0],c=a[1],p=F(n.pressure,i.pressure),d=p[0],l=p[1],f=F(n.tiltX,i.tiltX),y=f[0],v=f[1],g=F(n.tiltY,i.tiltY),m=g[0],w=g[1],P=F(n.timestamp,i.timestamp),S=P[0],k=P[1],[{x:s,y:h,pressure:d,tiltX:y,tiltY:m,timestamp:S},{x:u,y:c,pressure:l,tiltX:v,tiltY:w,timestamp:k}];var e,n,i,o,r,s,u,a,h,c,p,d,l,f,y,v,g,m,w,P,S,k},t}();function F(t,e){var n=(e-t)/3;return[t+n,e-n]}function B(t,e){return{x:t.x-e.x,y:t.y-e.y}}function z(t,e){var n=B(t,e);return function(t,e){return t.x*e.x+t.y*e.y}(n,n)}function j(t,e,n){var i=z(e,t);if(0===i)return z(n,t);var o=(n.x-e.x)*(e.y-t.y)-(e.x-t.x)*(n.y-e.y);return o*o/i}var q=function(){function t(t){this.flatness=t*t}return t.prototype.beginStroke=function(t){this.output.beginStroke(t),this.beginPoint=t},t.prototype.addSegment=function(t,e,n){Z(this.beginPoint,t,e,n,this.flatness,this.output),this.output.addPoint(n),this.beginPoint=n},t.prototype.endStroke=function(t,e,n){Z(this.beginPoint,t,e,n,this.flatness,this.output),this.output.endStroke(n)},t}();function Z(t,e,n,i,o,r){var s=function(t,e,n,i){var o=X(t.x,e.x,n.x,i.x),r=o[0],s=o[1],u=o[2],a=o[3],h=o[4],c=o[5],p=o[6],d=X(t.y,e.y,n.y,i.y),l=d[0],f=d[1],y=d[2],v=d[3],g=d[4],m=d[5],w=d[6],P=X(t.pressure,e.pressure,n.pressure,i.pressure),S=P[0],k=P[1],x=P[2],b=P[3],T=P[4],E=P[5],M=P[6],I=X(t.tiltX,e.tiltX,n.tiltX,i.tiltX),O=I[0],C=I[1],A=I[2],D=I[3],R=I[4],L=I[5],N=I[6],U=X(t.tiltY,e.tiltY,n.tiltY,i.tiltY),H=U[0],_=U[1],W=U[2],V=U[3],Y=U[4],F=U[5],B=U[6],z=X(t.timestamp,e.timestamp,n.timestamp,i.timestamp);return[{x:r,y:l,pressure:S,tiltX:O,tiltY:H,timestamp:z[0]},{x:s,y:f,pressure:k,tiltX:C,tiltY:_,timestamp:z[1]},{x:u,y:y,pressure:x,tiltX:A,tiltY:W,timestamp:z[2]},{x:a,y:v,pressure:b,tiltX:D,tiltY:V,timestamp:z[3]},{x:h,y:g,pressure:T,tiltX:R,tiltY:Y,timestamp:z[4]},{x:c,y:m,pressure:E,tiltX:L,tiltY:F,timestamp:z[5]},{x:p,y:w,pressure:M,tiltX:N,tiltY:B,timestamp:z[6]}]}(t,e,n,i),u=s[0],a=s[1],h=s[2],c=s[3],p=s[4],d=s[5],l=s[6];j(u,l,c)<=o||(Z(u,a,h,c,o,r),r.addPoint(c),Z(c,p,d,l,o,r))}var K=function(){function t(){this.lastPressure=.5}return t.prototype.beginStroke=function(t){this.output.beginStroke(t),this.lastPressure=t.pressure},t.prototype.addPoint=function(t){this.output.addPoint(t),this.lastPressure=t.pressure},t.prototype.endStroke=function(t){this.output.endStroke(0===t.pressure?{x:t.x,y:t.y,pressure:this.lastPressure,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timestamp}:t)},t}(),G=function(){function t(t){var e,n,i,o,r,s;this.pointerToStroke=U(),this.deduper=new H,this.endStrokePressure=new K,this.jitter=new _,this.fitter=new Y,this.flattener=new q(t),e=this.pointerToStroke,n=this.deduper,i=this.endStrokePressure,o=this.jitter,r=this.fitter,s=this.flattener,C(e,n,i),A(i,o,r,s)}return t.prototype.onPointerDown=function(t){O(this.flattener,this.output),this.pointerToStroke.onPointerDown(t)},t.prototype.onPointerMove=function(t){this.pointerToStroke.onPointerMove(t)},t.prototype.onPointerUp=function(t){this.pointerToStroke.onPointerUp(t)},t}();function J(t){return"pen"===t.pointerType}var Q=function(){function t(t){this.element=t}return t.prototype.onPointerOver=function(t){J(t)&&a(this.element)},t.prototype.onPointerOut=function(t){J(t)&&h(this.element)},t}(),$=function(){function t(t){this.hapticsExtractor=new p,this.waveform=t}return Object.defineProperty(t.prototype,"output",{set:function(t){O(this.hapticsExtractor,t)},enumerable:!1,configurable:!0}),t.prototype.onPointerDown=function(t){this.hapticsExtractor.onPointerDown(t),this.hapticsExtractor.play(this.waveform)},t.prototype.onPointerMove=function(t){this.hapticsExtractor.onPointerMove(t)},t.prototype.onPointerUp=function(t){this.hapticsExtractor.onPointerUp(t),this.hapticsExtractor.stop()},t}(),tt=function(){function t(t){var e=this;this.onPointerDown=function(t){e.output.onPointerDown(t)},this.onTouchStart=function(t){e.output.onTouchStart(t)},this.element=t}return t.prototype.activate=function(){this.element.addEventListener("pointerdown",this.onPointerDown,!0),this.element.addEventListener("touchstart",this.onTouchStart,!0)},t.prototype.deactivate=function(){this.element.removeEventListener("pointerdown",this.onPointerDown,!0),this.element.removeEventListener("touchstart",this.onTouchStart,!0)},t}(),et=function(){function t(t){var e=this;this.onPointerOver=function(t){e.output.onPointerOver(t)},this.onPointerOut=function(t){e.output.onPointerOut(t)},this.element=t}return t.prototype.activate=function(){this.element.addEventListener("pointerover",this.onPointerOver),this.element.addEventListener("pointerout",this.onPointerOut)},t.prototype.deactivate=function(){this.element.removeEventListener("pointerover",this.onPointerOver),this.element.removeEventListener("pointerout",this.onPointerOut)},t}();function nt(t){return 2===t.button||2==(2&t.buttons)}function it(t){return 5===t.button||32==(32&t.buttons)}var ot=function(){function t(){this.active=!1}return t.prototype.onMouseDown=function(t){this.output.onMouseDown(t),this.active=!0},t.prototype.onMouseMove=function(t){this.active&&this.output.onMouseMove(t)},t.prototype.onMouseUp=function(t){this.active=!1,this.output.onMouseUp(t)},t}(),rt=function(){function t(t){var e=this;this.onMouseDown=function(t){e.output.onMouseDown(t)},this.onMouseMove=function(t){e.output.onMouseMove(t)},this.onMouseUp=function(t){e.output.onMouseUp(t)},this.element=t}return t.prototype.activate=function(){this.element.addEventListener("mousedown",this.onMouseDown),this.element.addEventListener("mousemove",this.onMouseMove),this.element.addEventListener("mouseup",this.onMouseUp)},t.prototype.deactivate=function(){this.element.removeEventListener("mousedown",this.onMouseDown),this.element.removeEventListener("mousemove",this.onMouseMove),this.element.removeEventListener("mouseup",this.onMouseUp)},t}();function st(t){t.preventDefault()}function ut(t){t.preventDefault(),t.stopPropagation()}var at=function(){function t(){}return t.prototype.onMouseDown=function(t){this.output.onMouseDown(t),ut(t)},t.prototype.onMouseMove=function(t){this.output.onMouseMove(t),ut(t)},t.prototype.onMouseUp=function(t){this.output.onMouseUp(t),ut(t)},t}(),ht=function(){function t(t){C(this.head=new rt(t),new at,this.tail=new ot)}return t.prototype.activate=function(){this.head.activate()},t.prototype.deactivate=function(){this.head.deactivate()},Object.defineProperty(t.prototype,"output",{set:function(t){this.tail.output=t},enumerable:!1,configurable:!0}),t}();function ct(t){return{offsetX:t.offsetX,offsetY:t.offsetY,pressure:.5,tiltX:0,tiltY:0,timeStamp:t.timeStamp,pointerType:"mouse"}}var pt=function(){function t(){}return t.prototype.onMouseDown=function(t){this.output.onPointerDown(ct(t))},t.prototype.onMouseMove=function(t){this.output.onPointerMove(ct(t))},t.prototype.onMouseUp=function(t){this.output.onPointerUp(ct(t))},t}(),dt=function(){function t(t,e,n){this.normalOutput=t,this.tailOutput=e,this.barrelOutput=n,this.output=t}return t.prototype.onPointerDown=function(t){J(t)?it(t)?this.output=this.tailOutput:nt(t)?this.output=this.barrelOutput:this.output=this.normalOutput:this.output=this.normalOutput,this.output.onPointerDown(t)},t.prototype.onPointerMove=function(t){this.output.onPointerMove(t)},t.prototype.onPointerUp=function(t){this.output.onPointerUp(t)},t}(),lt=function(){function t(){this.activePointerId=-1}return t.prototype.onPointerDown=function(t){-1===this.activePointerId&&(this.activePointerId=t.pointerId,this.output.onPointerDown(t))},t.prototype.onPointerMove=function(t){this.activePointerId===t.pointerId&&this.output.onPointerMove(t)},t.prototype.onPointerUp=function(t){this.activePointerId===t.pointerId&&(this.output.onPointerUp(t),this.activePointerId=-1)},t}(),ft=function(){function t(t){this.element=t}return t.prototype.onPointerDown=function(t){try{this.element.setPointerCapture(t.pointerId)}finally{this.output.onPointerDown(t)}},t.prototype.onPointerMove=function(t){this.output.onPointerMove(t)},t.prototype.onPointerUp=function(t){this.output.onPointerUp(t)},t}();var yt=function(){function t(){}return t.prototype.onPointerDown=function(t){this.output.onPointerDown(t)},t.prototype.onPointerMove=function(t){var e=this;(function(t){if("getCoalescedEvents"in t){var e=t.getCoalescedEvents();if(e.length>=1)return e}return[t]})(t).forEach((function(t){e.output.onPointerMove(t)}))},t.prototype.onPointerUp=function(t){this.output.onPointerUp(t)},t}(),vt=function(){function t(t){var e=this;this.onPointerDown=function(t){e.output.onPointerDown(t)},this.onPointerMove=function(t){e.output.onPointerMove(t)},this.onPointerUp=function(t){e.output.onPointerUp(t)},this.element=t}return t.prototype.activate=function(){this.element.addEventListener("pointerdown",this.onPointerDown),this.element.addEventListener("pointermove",this.onPointerMove),this.element.addEventListener("pointerup",this.onPointerUp)},t.prototype.deactivate=function(){this.element.removeEventListener("pointerdown",this.onPointerDown),this.element.removeEventListener("pointermove",this.onPointerMove),this.element.removeEventListener("pointerup",this.onPointerUp)},t}(),gt=function(){function t(t){this.element=t}return t.prototype.activate=function(){this.element.addEventListener("touchmove",st)},t.prototype.deactivate=function(){this.element.removeEventListener("touchmove",st)},t}(),mt=function(){function t(){}return t.prototype.onPointerDown=function(t){this.output.onPointerDown(t),ut(t)},t.prototype.onPointerMove=function(t){this.output.onPointerMove(t),ut(t)},t.prototype.onPointerUp=function(t){this.output.onPointerUp(t),ut(t)},t}(),wt=function(){function t(t){var e,n,i,o,r;e=this.head=new vt(t),n=new ft(t),i=new mt,o=new lt,r=this.tail=new yt,C(e,n,i),C(i,o,r),(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&(this.preventDefaultOnTouchMove=new gt(t))}return t.prototype.activate=function(){var t;this.head.activate(),null===(t=this.preventDefaultOnTouchMove)||void 0===t||t.activate()},t.prototype.deactivate=function(){var t;this.head.deactivate(),null===(t=this.preventDefaultOnTouchMove)||void 0===t||t.deactivate()},Object.defineProperty(t.prototype,"output",{set:function(t){this.tail.output=t},enumerable:!1,configurable:!0}),t}(),Pt=function(){function t(){this.wasPenDown=!1}return t.prototype.onPointerDown=function(t){this.wasPenDown=J(t)},t.prototype.onTouchStart=function(t){this.wasPenDown&&ut(t)},t}();var St=function(){function t(){this.activeIdentifier=-1}return t.prototype.onTouchStart=function(t,e){-1===this.activeIdentifier&&(this.activeIdentifier=e.identifier,this.output.onTouchStart(t,e))},t.prototype.onTouchMove=function(t,e){this.activeIdentifier===e.identifier&&this.output.onTouchMove(t,e)},t.prototype.onTouchEnd=function(t,e){this.activeIdentifier===e.identifier&&(this.output.onTouchEnd(t,e),this.activeIdentifier=-1)},t}(),kt=function(){function t(){}return t.prototype.onTouchStart=function(t){for(var e=0;e<t.changedTouches.length;e+=1)this.output.onTouchStart(t,t.changedTouches[e])},t.prototype.onTouchMove=function(t){for(var e=0;e<t.changedTouches.length;e+=1)this.output.onTouchMove(t,t.changedTouches[e])},t.prototype.onTouchEnd=function(t){for(var e=0;e<t.changedTouches.length;e+=1)this.output.onTouchEnd(t,t.changedTouches[e])},t}(),xt=function(){function t(t){var e=this;this.onTouchStart=function(t){e.output.onTouchStart(t)},this.onTouchMove=function(t){e.output.onTouchMove(t)},this.onTouchEnd=function(t){e.output.onTouchEnd(t)},this.element=t}return t.prototype.activate=function(){this.element.addEventListener("touchstart",this.onTouchStart),this.element.addEventListener("touchmove",this.onTouchMove),this.element.addEventListener("touchend",this.onTouchEnd)},t.prototype.deactivate=function(){this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchmove",this.onTouchMove),this.element.removeEventListener("touchend",this.onTouchEnd)},t}(),bt=function(){function t(){}return t.prototype.onTouchStart=function(t){this.output.onTouchStart(t),ut(t)},t.prototype.onTouchMove=function(t){this.output.onTouchMove(t),ut(t)},t.prototype.onTouchEnd=function(t){this.output.onTouchEnd(t),ut(t)},t}(),Tt=function(){function t(t){A(this.head=new xt(t),new bt,new kt,this.tail=new St)}return t.prototype.activate=function(){this.head.activate()},t.prototype.deactivate=function(){this.head.deactivate()},Object.defineProperty(t.prototype,"output",{set:function(t){this.tail.output=t},enumerable:!1,configurable:!0}),t}();function Et(t){return 180*t/Math.PI}function Mt(t,e){var n=e.target.getBoundingClientRect();return{offsetX:e.clientX-n.left,offsetY:e.clientY-n.top,pressure:e.force,tiltX:Et(Math.atan(Math.cos(e.azimuthAngle)/Math.tan(e.altitudeAngle))),tiltY:Et(Math.atan(Math.sin(e.azimuthAngle)/Math.tan(e.altitudeAngle))),timeStamp:t.timeStamp,pointerType:"touch"}}var It=function(){function t(){}return t.prototype.onTouchStart=function(t,e){this.output.onPointerDown(Mt(t,e))},t.prototype.onTouchMove=function(t,e){this.output.onPointerMove(Mt(t,e))},t.prototype.onTouchEnd=function(t,e){this.output.onPointerUp(Mt(t,e))},t}(),Ot=function(){function t(){this.offsetX=0,this.offsetY=0}return t.prototype.setDrawingAttributes=function(t){this.output.setDrawingAttributes(1===t.effect.type?new P(t).setEffect({type:1,pattern:t.effect.pattern,offsetX:this.offsetX,offsetY:this.offsetY}).build():t)},t.prototype.beginStroke=function(t){this.output.beginStroke(t),this.begin=t},t.prototype.addPoint=function(t){this.output.addPoint(t)},t.prototype.endStroke=function(t){this.output.endStroke(t);var e=t.x-this.begin.x,n=t.y-this.begin.y,i=e>0?48:-48;this.offsetX+=e+i,this.offsetY+=n+i,this.offsetX%=540,this.offsetY%=540},t}(),Ct=function(){function t(){this.attributes=g,this.offset=new Ot}return t.prototype.setDrawingAttributes=function(t){this.attributes=t},t.prototype.beginStroke=function(t){O(this.offset,this.output),this.out=1===this.attributes.effect.type?this.offset:this.output,this.out.setDrawingAttributes(this.attributes),this.out.beginStroke(t)},t.prototype.addPoint=function(t){this.out.addPoint(t)},t.prototype.endStroke=function(t){this.out.endStroke(t)},t}();function At(t,e,n){for(var i=[-e.x,e.x,-e.y,e.y],o=[t.x-n.left,n.right-t.x,t.y-n.top,n.bottom-t.y],r=0,s=1,u=0;u<4;u+=1)if(0===i[u]){if(o[u]<0)return[10,-10]}else i[u]<0?r=Math.max(r,o[u]/i[u]):s=Math.min(s,o[u]/i[u]);return[r,s]}function Dt(){return{left:Number.MAX_VALUE,right:-Number.MAX_VALUE,top:Number.MAX_VALUE,bottom:-Number.MAX_VALUE}}function Rt(t,e){t.left=Math.min(t.left,e.left),t.top=Math.min(t.top,e.top),t.right=Math.max(t.right,e.right),t.bottom=Math.max(t.bottom,e.bottom)}function Lt(t,e,n){var i=At(t,B(e,t),n);return i[0]<=i[1]}function Nt(t,e,n,i){var o=e.x-t.x,r=e.y-t.y,s=i.x-n.x,u=i.y-n.y,a=o*u-s*r;if(0===a)return!1;var h=(s*(t.y-n.y)-u*(t.x-n.x))/a,c=(o*(t.y-n.y)-r*(t.x-n.x))/a;return h>=0&&h<=1&&c>=0&&c<=1}function Ut(){}var Ht=function(){function t(t,e){this.hapticsExtractor=new p,this.playHapticsInterval=0,this.needPlayStrokeHitHaptics=!1,this.needRestartContinuousHaptics=!1,this.inkDryStore=t,this.hitTestDataMap=new Map,this.shapeNodesErased=new Set,this.viewModelModifier=e}return t.prototype.onPointerDown=function(t){this.hapticsExtractor.onPointerDown(t),this.previousPoint={x:t.offsetX,y:t.offsetY},this.generateHitTestData()},t.prototype.onPointerMove=function(t){var e=this;this.hapticsExtractor.onPointerMove(t);var n={x:t.offsetX,y:t.offsetY},i=new Set;this.hitTestDataMap.forEach((function(t,o){var r,s=!1,u=16-((r=t.bounds).right-r.left),a=16-function(t){return t.bottom-t.top}(t.bounds);u>=0&&a>=0&&function(t,e,n,i,o){return Lt(t,e,function(t,e,n){return{left:t.left-e,right:t.right+e,top:t.top-n,bottom:t.bottom+n}}(n,i,o))}(e.previousPoint,n,t.bounds,u/2,a/2)?s=!0:Lt(e.previousPoint,n,t.bounds)&&t.strokeCollection.stream({add:function(t){!s&&function(t,e,n){var i,o=!1,r={add:Ut},s=function(t){Nt(i,t,e,n)&&(r.add=Ut,o=!0),i=t};return r.add=function(t){r.add=s,i=t},t.streamPoints(r),o}(t,e.previousPoint,n)&&(s=!0)}}),s&&i.add(o)})),i.forEach((function(t){e.shapeNodesErased.add(t),e.hitTestDataMap.delete(t)})),this.hideInkCollections(i),0!==i.size&&this.ensurePlayStrokeHitHaptics(),this.previousPoint=n},t.prototype.onPointerUp=function(t){this.hapticsExtractor.onPointerUp(t),this.clearHaptics(),this.hitTestDataMap.clear(),this.deleteInkCollections(this.shapeNodesErased),this.shapeNodesErased.size>0&&I.info("Strokes erased count: "+this.shapeNodesErased.size+". Pointer type: "+t.pointerType+"."),this.shapeNodesErased.clear(),I.info("Action: Eraser. PointerType: "+t.pointerType+".")},t.prototype.generateHitTestData=function(){this.hitTestDataMap=this.inkDryStore.generateHitTestData()},t.prototype.deleteInkCollections=function(t){var e=this;t.forEach((function(n){e.inkDryStore.unregisterInk(n)||t.delete(n)}));var n=[];t.forEach((function(t){n.push(t)})),this.viewModelModifier.deleteInkCollections(n)},t.prototype.hideInkCollections=function(t){var e=[];t.forEach((function(t){e.push(t)})),this.viewModelModifier.hideInkCollections(e)},t.prototype.ensurePlayStrokeHitHaptics=function(){var t=this;this.needPlayStrokeHitHaptics=!0,0===this.playHapticsInterval&&(this.playHapticsInterval=window.setInterval((function(){return t.playStrokeEraserHaptics()}),50))},t.prototype.clearHaptics=function(){0!==this.playHapticsInterval&&(this.hapticsExtractor.stop(),window.clearInterval(this.playHapticsInterval),this.playHapticsInterval=0,this.needPlayStrokeHitHaptics=!1,this.needRestartContinuousHaptics=!1)},t.prototype.playStrokeEraserHaptics=function(){var t,e=this;this.needPlayStrokeHitHaptics?(this.hapticsExtractor.play((function(){return c({waveformId:i.WAVEFORM_CLICK,intensity:e.hapticsExtractor.isPointerDown?1:.75,vendorId:"",alternates:[]})})),this.needPlayStrokeHitHaptics=!1,this.needRestartContinuousHaptics=!0):this.needRestartContinuousHaptics&&(null===(t=this.hapticsExtractor)||void 0===t||t.play((function(){return c({waveformId:i.WAVEFORM_ERASER_CONTINUOUS,intensity:1,vendorId:"",alternates:[]})})),this.needRestartContinuousHaptics=!1)},t}();function _t(t){t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.restore()}function Wt(t,e,n,i){t.style.width=n+"px",t.style.height=i+"px",t.width=n*e,t.height=i*e}var Xt={alpha:!0,desynchronized:!1};function Vt(t,e){var n=t.getContext("2d",e);if(null===n)throw new Error("Could not get 2D context from canvas.");return n}function Yt(t,e,n,i,o){var r=Vt(t,o);return function(t,e,n,i,o){Wt(t,e,i,o),n.setTransform(1,0,0,1,0,0),n.scale(e,e)}(t,e,r,n,i),r}function Ft(t,e,n,i){return Yt(t,e,n,i,Xt)}var Bt=function(){function t(){this.id=0,this.drawingAttributes=g,this.points=[]}return t.prototype.streamChannels=function(t){this.points.forEach((function(e){t.addPoint(e),t.addPressure(function(t){return t.pressure}(e)),t.addTilt(e),t.addTimestamp(function(t){return t.timestamp}(e))}))},t.prototype.streamPoints=function(t){this.points.forEach((function(e){t.add(e)}))},t.prototype.streamPath=function(t){zt(this,t,0)},t.prototype.stream=function(t){jt(this,t,0)},t.prototype.add=function(t){this.points.push(t)},t}();function zt(t,e,n){if(n+2>t.points.length)return n;e.beginStroke(t.points[n]);for(var i=n+1;i<t.points.length-1;i+=1)e.addPoint(t.points[i]);return e.endStroke(t.points[t.points.length-1]),t.points.length-1}function jt(t,e,n){return e.setDrawingAttributes(t.drawingAttributes),zt(t,e,n)}function qt(t,e){var n=0,i=0;return t.streamPoints({add:function(t){(function(t,e){var n,i,o=0,r=0,s={x:1e11,y:20},u=function(e){Nt(i,e,t,s)&&(o+=1),i=e,r+=1},a={add:function(t){n=t,i=t,r+=1,a.add=u}};return e.streamPoints(a),!(r<3)&&(u(n),o%2==1)})(t,e)&&(n+=1),i+=1}}),{enclosed:n,total:i}}var Zt=function(){function t(){}return t.prototype.beginStroke=function(t){this.output.add(t)},t.prototype.addPoint=function(t){this.output.add(t)},t.prototype.endStroke=function(t){this.output.add(t)},t}(),Kt=function(){function t(t,e,n){this.context=t,this.fillStyle=e,this.strokeStyle=n}return t.prototype.setDrawingAttributes=function(){},t.prototype.beginStroke=function(t){this.context.save(),this.context.lineCap="butt",this.context.lineJoin="miter",this.context.setLineDash([5,5]),this.context.fillStyle=this.fillStyle,this.context.strokeStyle=this.strokeStyle,this.context.beginPath(),this.context.moveTo(t.x,t.y)},t.prototype.addPoint=function(t){this.context.lineTo(t.x,t.y)},t.prototype.endStroke=function(t){this.addPoint(t),this.context.closePath(),this.context.fill(),this.context.stroke(),this.context.restore()},t}(),Gt=function(){function t(t,e,n){this.transform=new N,this.adapter=new Zt,this.lassoStroke=new Bt,this.hapticsExtractor=new p,this.inkDryStore=t,A(this.hapticsExtractor,this.transform,this.adapter,this.lassoStroke),this.context=Ft(e,window.devicePixelRatio,e.clientWidth,e.clientHeight),this.renderer=new Kt(this.context,"rgba(128, 128, 128, 0.39)","#9b9b9b"),this.viewModelModifier=n,this.hitTestDataMap=new Map}return t.prototype.onPointerDown=function(t){this.hapticsExtractor.onPointerDown(t),this.generateHitTestData(),this.viewModelModifier.clearSelection()},t.prototype.onPointerMove=function(t){this.hapticsExtractor.onPointerMove(t),_t(this.context),this.lassoStroke.streamPath(this.renderer)},t.prototype.onPointerUp=function(t){this.hapticsExtractor.onPointerUp(t),this.hitTest(t.pointerType),this.lassoStroke=new Bt,A(this.hapticsExtractor,this.transform,this.adapter,this.lassoStroke),_t(this.context),I.info("Action: Lasso. PointerType: "+t.pointerType+".")},t.prototype.hitTest=function(t){var e=this,n=[];this.hitTestDataMap.forEach((function(t,i){var o=!1;t.strokeCollection.stream({add:function(t){!o&&function(t,e,n){var i=qt(t,e);return i.enclosed/i.total>n}(t,e.lassoStroke,.6)&&(o=!0)}}),o&&n.push(i)})),I.info("Strokes lassoed count: "+n.length+". Pointer type: "+t+"."),0!==n.length&&this.hapticsExtractor.play((function(){return c({waveformId:i.WAVEFORM_CLICK,intensity:e.hapticsExtractor.isPointerDown?1:.75,vendorId:"",alternates:[]})})),this.viewModelModifier.selectInkCollections(n)},t.prototype.generateHitTestData=function(){this.hitTestDataMap=this.inkDryStore.generateHitTestData()},t}(),Jt=function(){function t(t,e,n,o,r,s,u,a){var h=this;if(this.isPenOnly=!1,this.store=n,this.drawingHaptics=a,u?C(this.drawer=new G(.5),this.injector=new Ct,this.store.collector):A(this.drawer=U(),new H,this.injector=new Ct,this.store.collector),this.eraser=new Ht(o,s),this.lasso=new Gt(o,r,s),this.outputSwitcher=new dt(this.drawer,this.eraser,this.lasso),void 0!==window.PointerEvent)this.continuousHaptics=new $((function(){var t;if(h.outputSwitcher.output===h.drawer)t=h.drawingHaptics();else{if(h.outputSwitcher.output!==h.eraser)return;t=i.WAVEFORM_ERASER_CONTINUOUS}return c({waveformId:t,intensity:1,vendorId:"",alternates:[]})})),A(this.input=new wt(t),this.continuousHaptics,{output:this.outputSwitcher,onPointerDown:function(t){try{r.setPointerCapture(t.pointerId)}catch(t){}(it(t)||nt(t))&&h.store.strokeBeginEndListener.dryAllStrokes(),h.outputSwitcher.onPointerDown(t),!h.isPenOnly&&J(t)&&s.notifyPenDownOnCanvas()},onPointerMove:function(t){h.outputSwitcher.onPointerMove(t)},onPointerUp:function(t){h.outputSwitcher.onPointerUp(t);try{r.releasePointerCapture(t.pointerId)}catch(t){}}},this.outputSwitcher);else if(void 0!==window.TouchEvent){var p=new Tt(t);C(p,new It,this.outputSwitcher),this.input=p}else{var d=new ht(t);C(d,new pt,this.outputSwitcher),this.input=d}O(this.pointerActivation=new tt(e),new Pt),O(this.pointerOverOut=new et(e),new Q(t))}return t.prototype.activate=function(){this.input.activate(),this.activatePenOnly()},t.prototype.deactivate=function(){this.deactivatePenOnly(),this.input.deactivate()},t.prototype.activatePenOnly=function(){this.pointerActivation.activate(),this.pointerOverOut.activate(),this.isPenOnly=!0},t.prototype.deactivatePenOnly=function(){this.isPenOnly=!1,this.pointerOverOut.deactivate(),this.pointerActivation.deactivate()},t.prototype.setErasing=function(){this.outputSwitcher.normalOutput=this.eraser,this.store.strokeBeginEndListener.dryAllStrokes()},t.prototype.setDrawing=function(){this.outputSwitcher.normalOutput=this.drawer},t.prototype.setLassoing=function(){this.outputSwitcher.normalOutput=this.lasso,this.store.strokeBeginEndListener.dryAllStrokes()},t}(),Qt=function(){function t(){this.modifier=function(t){return t}}return t.prototype.setDrawingAttributes=function(t){this.output.setDrawingAttributes(this.modifier(t))},t.prototype.beginStroke=function(t){this.output.beginStroke(t)},t.prototype.addPoint=function(t){this.output.addPoint(t)},t.prototype.endStroke=function(t){this.output.endStroke(t)},t}(),$t=function(){function t(t){var e=this;this.isLoopActive=!1,this.animationCallback=function(){e.delegate(),e.isLoopActive&&window.requestAnimationFrame(e.animationCallback)},this.delegate=t}return t.prototype.onStrokeBegin=function(){this.isLoopActive=!0,window.requestAnimationFrame(this.animationCallback)},t.prototype.onStrokeEnd=function(){this.isLoopActive=!1},t}();function te(t){throw t}var ee=function(){function t(t){this.context=t}return t.prototype.beginPath=function(){this.context.beginPath()},t.prototype.arc=function(t,e,n,i,o,r){this.context.arc(t,e,n,i,o,r)},t.prototype.circularArc=function(t,e,n,i,o,r,s,u,a){var h=Math.atan2(e-i,t-n),c=Math.atan2(s-i,r-n);h=h<0?2*Math.PI+h:h,c=c<0?2*Math.PI+c:c,this.arc(n,i,o,h,c,a)},t.prototype.lineTo=function(t,e){this.context.lineTo(t,e)},t.prototype.moveTo=function(t,e){this.context.moveTo(t,e)},t.prototype.closePath=function(){this.context.closePath()},t}(),ne=function(){function t(){}return t.prototype.toCSSColor=function(t){return function(t){return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"}(t)},t}();function ie(t,e){return void 0===e&&(e=1e-6),t<-e||e<t}function oe(t,e,n){return void 0===n&&(n=1e-6),function(t,e){return void 0===e&&(e=1e-6),-e<=t&&t<=e}(t-e,n)}function re(t){return 1.5*t+.25}var se=function(t,e,n){this.incomingTangent1={x:Number.NaN,y:Number.NaN},this.incomingTangent2={x:Number.NaN,y:Number.NaN},this.outgoingTangent1={x:Number.NaN,y:Number.NaN},this.outgoingTangent2={x:Number.NaN,y:Number.NaN},this.center={x:t,y:e},this.radius=n},ue=function(){function t(t,e){this.stroke=[],this.builder=t,this.tipRadius=e.width/2}return t.prototype.beginStroke=function(t){this.builder.beginPath(),this.stroke=[],this.addPoint(t)},t.prototype.addPoint=function(t){var e=new se(t.x,t.y,this.tipRadius*re(t.pressure));this.stroke.push(e)},t.prototype.endStroke=function(t){this.addPoint(t),function(t){for(var e=1;e<t.length;e++){var n=t[e-1],i=t[e],o=n.center.x,r=n.center.y,s=n.radius,u=i.center.x,a=i.center.y,h=i.radius,c=o-u,p=r-a,d=Math.sqrt(c*c+p*p),l=Math.abs(h-s);if(!(l>d)){var f=1/d,y=l*f,v=Math.sqrt(1-y*y),g=c*f,m=p*f;s>h&&(v=-v,g=-g,m=-m);var w=g*y,P=m*y,S=g*v,k=m*v,x=w+k,b=P-S,T=w-k,E=P+S;n.outgoingTangent1.x=o+s*x,n.outgoingTangent1.y=r+s*b,n.outgoingTangent2.x=o+s*T,n.outgoingTangent2.y=r+s*E,i.incomingTangent1.x=u+h*x,i.incomingTangent1.y=a+h*b,i.incomingTangent2.x=u+h*T,i.incomingTangent2.y=a+h*E}}}(this.stroke),function(t,e){for(var n=0,i=0;i<e.length;i++)(i===e.length-1||isNaN(e[i].outgoingTangent1.x))&&(ae(t,e,n,i),n=i+1)}(this.builder,this.stroke),this.builder.closePath()},t}();function ae(t,e,n,i){if(n===i){var o=e[n];return t.moveTo(o.center.x-o.radius,o.center.y),t.circularArc(o.center.x-o.radius,o.center.y,o.center.x,o.center.y,o.radius,o.center.x+o.radius,o.center.y,!1,!0),void t.circularArc(o.center.x+o.radius,o.center.y,o.center.x,o.center.y,o.radius,o.center.x-o.radius,o.center.y,!1,!0)}var r=e[n];t.moveTo(r.outgoingTangent1.x,r.outgoingTangent1.y);var s,u=r;r=e[n+1];for(var a=n+1;a<i;a++){s=e[a+1],void 0!==(c=he(u.outgoingTangent1,r.incomingTangent1,r.outgoingTangent1,s.incomingTangent1))?t.lineTo(c.x,c.y):(t.lineTo(r.incomingTangent1.x,r.incomingTangent1.y),t.circularArc(r.incomingTangent1.x,r.incomingTangent1.y,r.center.x,r.center.y,r.radius,r.outgoingTangent1.x,r.outgoingTangent1.y,!1,!0)),u=r,r=s}var h=r.radius>e[i-1].radius;t.lineTo(r.incomingTangent1.x,r.incomingTangent1.y),t.circularArc(r.incomingTangent1.x,r.incomingTangent1.y,r.center.x,r.center.y,r.radius,r.incomingTangent2.x,r.incomingTangent2.y,h,!0),u=r,r=e[i-1];for(a=i-1;a>n;a--){var c;s=e[a-1],void 0!==(c=he(u.incomingTangent2,r.outgoingTangent2,r.incomingTangent2,s.outgoingTangent2))?t.lineTo(c.x,c.y):(t.lineTo(r.outgoingTangent2.x,r.outgoingTangent2.y),t.circularArc(r.outgoingTangent2.x,r.outgoingTangent2.y,r.center.x,r.center.y,r.radius,r.incomingTangent2.x,r.incomingTangent2.y,!1,!0)),u=r,r=s}var p=r.radius>e[n+1].radius;t.lineTo(r.outgoingTangent2.x,r.outgoingTangent2.y),t.circularArc(r.outgoingTangent2.x,r.outgoingTangent2.y,r.center.x,r.center.y,r.radius,r.outgoingTangent1.x,r.outgoingTangent1.y,p,!0)}function he(t,e,n,i){if(!((i.x-n.x)*(e.y-t.y)-(e.x-t.x)*(i.y-n.y)>0)){var o=e.y-t.y,r=t.x-e.x,s=o*t.x+r*t.y,u=i.y-n.y,a=n.x-i.x,h=u*n.x+a*n.y,c=o*a-u*r;if(ie(c)){var p=1/c,d=(a*s-r*h)*p,l=(o*h-u*s)*p;if(ce(d,l,t,e)&&ce(d,l,n,i))return{x:d,y:l}}}}function ce(t,e,n,i){return(Math.min(n.x,i.x)<t||oe(Math.min(n.x,i.x),t))&&(Math.max(n.x,i.x)>t||oe(Math.max(n.x,i.x),t))&&(Math.min(n.y,i.y)<e||oe(Math.min(n.y,i.y),e))&&(Math.max(n.y,i.y)>e||oe(Math.max(n.y,i.y),e))}function pe(t,e,n,i,o){var r=n.x-t.x,s=n.y-t.y,u=Math.sqrt(r*r+s*s);if(u<=Math.abs(i-e))return!1;var a=r/u,h=-s/u,c=(i-e)/u,p=Math.sqrt(1-c*c),d=h*p+a*c,l=a*p-h*c,f=h*p-a*c,y=a*p+h*c;return o.p1.x=t.x-d*e,o.p1.y=t.y-l*e,o.p2.x=n.x-d*i,o.p2.y=n.y-l*i,o.p3.x=n.x+f*i,o.p3.y=n.y+y*i,o.p4.x=t.x+f*e,o.p4.y=t.y+y*e,!0}function de(t,e,n,i,o,r,s){var u=t.x-e,a=t.y-n,h=t.x+e,c=t.y+n,p=i.x-o,d=i.y-r,l=i.x+o,f=i.y+r;if(p>=u&&d>=a&&l<=h&&f<=c||u>=p&&a>=d&&h<=l&&c<=f)return!1;var y=i.x-t.x>0?1:-1,v=i.y-t.y>0?1:-1;return s.p1.x=t.x-v*e,s.p1.y=t.y+y*n,s.p2.x=t.x+v*e,s.p2.y=t.y-y*n,s.p3.x=i.x+v*o,s.p3.y=i.y-y*r,s.p4.x=i.x-v*o,s.p4.y=i.y+y*r,!0}var le=2*Math.PI;function fe(t,e,n){t.arc(e.x,e.y,n,0,le)}function ye(t,e,n,i){var o=e.x-n,r=e.x+n,s=e.y-i,u=e.y+i;t.moveTo(o,s),t.lineTo(r,s),t.lineTo(r,u),t.lineTo(o,u),t.lineTo(o,s)}function ve(t,e){t.moveTo(e.p1.x,e.p1.y),t.lineTo(e.p2.x,e.p2.y),t.lineTo(e.p3.x,e.p3.y),t.lineTo(e.p4.x,e.p4.y),t.lineTo(e.p1.x,e.p1.y)}var ge=function(){function t(t,e){this.quad={p1:{x:0,y:0},p2:{x:0,y:0},p3:{x:0,y:0},p4:{x:0,y:0}},this.builder=t,this.tipRadius=e.width/2}return t.prototype.beginStroke=function(t){this.builder.beginPath(),this.updateRadius(t),fe(this.builder,t,this.radius),this.lastPoint=t},t.prototype.addPoint=function(t){this.updateRadius(t),pe(t,this.radius,this.lastPoint,this.lastRadius,this.quad)&&(ve(this.builder,this.quad),fe(this.builder,t,this.radius)),this.lastPoint=t},t.prototype.endStroke=function(t){this.addPoint(t),this.builder.closePath()},t.prototype.updateRadius=function(t){this.lastRadius=this.radius,this.radius=this.tipRadius*re(t.pressure)},t}(),me=function(){function t(t){this.builder=t}return t.prototype.beginStroke=function(t){this.builder.beginPath(),this.builder.moveTo(t.x,t.y)},t.prototype.addPoint=function(t){this.builder.lineTo(t.x,t.y)},t.prototype.endStroke=function(t){this.addPoint(t)},t}(),we=function(t,e,n,i){this.center={x:t,y:e},this.halfWidth=n,this.halfHeight=i},Pe=function(){function t(t,e){this.stroke=[],this.quads=[],this.builder=t,this.tipWidth=e.width/2,this.tipHeight=e.height/2}return t.prototype.beginStroke=function(t){this.builder.beginPath(),this.stroke=[],this.quads=[],this.addPoint(t)},t.prototype.addPoint=function(t){var e,n,i,o,r=re(t.pressure),s=new we(t.x,t.y,this.tipWidth*r,this.tipHeight*r),u=this.stroke.length;u>0&&(e=this.stroke[u-1],n=s,i=this.quads,o={p1:{x:0,y:0},p2:{x:0,y:0},p3:{x:0,y:0},p4:{x:0,y:0}},de(e.center,e.halfWidth,e.halfHeight,n.center,n.halfWidth,n.halfHeight,o)&&i.push(o)),this.stroke.push(s)},t.prototype.endStroke=function(t){this.addPoint(t),function(t,e,n){if(Se(t,e[0]),0===n.length)return;t.moveTo(n[0].p1.x,n[0].p1.y);for(var i=0;i<n.length;i++)t.lineTo(n[i].p2.x,n[i].p2.y),t.lineTo(n[i].p3.x,n[i].p3.y);for(i=n.length-1;i>=0;i--)t.lineTo(n[i].p4.x,n[i].p4.y),t.lineTo(n[i].p1.x,n[i].p1.y);e.length>2&&Se(t,e[e.length-2]);Se(t,e[e.length-1])}(this.builder,this.stroke,this.quads),this.builder.closePath()},t}();function Se(t,e){ye(t,e.center,e.halfWidth,e.halfHeight)}var ke=function(){function t(t,e){this.quad={p1:{x:0,y:0},p2:{x:0,y:0},p3:{x:0,y:0},p4:{x:0,y:0}},this.builder=t,this.tipHalfWidth=e.width/2,this.tipHalfHeight=e.height/2}return t.prototype.beginStroke=function(t){this.builder.beginPath(),this.updateSize(t),ye(this.builder,t,this.halfWidth,this.halfHeight),this.lastPoint=t},t.prototype.addPoint=function(t){this.updateSize(t),de(t,this.halfWidth,this.halfHeight,this.lastPoint,this.lastHalfWidth,this.lastHalfHeight,this.quad)&&(ve(this.builder,this.quad),ye(this.builder,t,this.halfWidth,this.halfHeight)),this.lastPoint=t},t.prototype.endStroke=function(t){this.addPoint(t),this.builder.closePath()},t.prototype.updateSize=function(t){this.lastHalfWidth=this.halfWidth,this.lastHalfHeight=this.halfHeight;var e=re(t.pressure);this.halfWidth=this.tipHalfWidth*e,this.halfHeight=this.tipHalfHeight*e},t}();function xe(t,e,n,i,o){t.lineWidth=e.height;var r=function(t,e,n,i,o){if(1===e.effect.type){var r=e.effect,s=n.toCanvasImageSource(r);if(void 0!==s){var u=t.createPattern(s,"repeat");if(null!==u){return t.scale(.5,.5),t.lineWidth=e.width/.5,t.translate(o.x-r.offsetX,o.y-r.offsetY),u}}}return i.toCSSColor(e.color,e)}(t,e,n,i,o);switch(t.strokeStyle=r,t.fillStyle=r,e.tip){case"ellipse":t.lineCap="round",t.lineJoin="round";break;case"rectangle":t.lineCap="butt",t.lineJoin="miter";break;default:te(e.tip)}switch(e.rasterOperation){case"copy":t.globalCompositeOperation="source-over";break;case"mask":t.globalCompositeOperation="darken";break;default:te(e.rasterOperation)}}var be=function(){function t(t,e,n){void 0===n&&(n=new ne),this.renderMode=0,this.context=t,this.canvasPathBuilder=new ee(t),this.effectResolver=e,this.colorResolver=n}return t.prototype.setDrawingAttributes=function(t){this.attributes=t},t.prototype.beginStroke=function(t){this.pathBuilder=this.makeNewPathBuilder(),this.pathBuilder.beginStroke(t),this.beginPoint=t},t.prototype.addPoint=function(t){this.pathBuilder.addPoint(t)},t.prototype.endStroke=function(t){this.pathBuilder.endStroke(t),this.context.save(),xe(this.context,this.attributes,this.effectResolver,this.colorResolver,this.beginPoint),2===this.renderMode?this.context.stroke():this.context.fill(),this.context.restore()},t.prototype.makeNewPathBuilder=function(){switch(this.renderMode){case 0:return"ellipse"===this.attributes.tip?new ge(this.canvasPathBuilder,this.attributes):new ke(this.canvasPathBuilder,this.attributes);case 1:return"ellipse"===this.attributes.tip?new ue(this.canvasPathBuilder,this.attributes):new Pe(this.canvasPathBuilder,this.attributes);case 2:return new me(this.canvasPathBuilder);default:te(this.renderMode)}},t}(),Te=function(){function t(){}return t.prototype.toCanvasImageSource=function(){},t.prototype.toSVGImageElement=function(){},t}();function Ee(t){var e=new be(t,new Te);if(u())return e;var n=new Qt;return n.modifier=function(t){return"mask"===t.rasterOperation?new P(t).setColor(new y(t.color).setAlpha(.5).build()).build():t},O(n,e),n}var Me=function(){function t(t,e,n){var i=this;this.strokeBeginEndListener={onStrokeBegin:function(){i.renderLoop.onStrokeBegin()},onStrokeEnd:function(){i.renderLoop.onStrokeEnd()}},this.incremental=!0,this.render=function(){i.incremental||i.clear(),i.store.collectChanges(i.transformer,i.incremental)},this.store=e,this.zoom=n>0?n:1,this.transformer=new Qt,this.wetContext=this.updateCanvasContext(this.zoom,t),this.wetRenderer=Ee(this.wetContext),O(this.transformer,this.wetRenderer),this.renderLoop=new $t(this.render)}return t.prototype.updateCanvasContext=function(t,e){var n=this;return this.wetContext=Ft(e,window.devicePixelRatio,e.clientWidth,e.clientHeight),this.zoom=t>0?t:1,this.transformer.modifier=function(t){return new P(t).setWidth(t.width*n.zoom).setHeight(t.height*n.zoom).build()},this.wetContext},t.prototype.clear=function(){_t(this.wetContext)},t.prototype.setIncrementalRender=function(t){this.incremental=t},t}();function Ie(){}var Oe=function(){function t(){this.baseId=0}return t.prototype.generate=function(){return this.baseId+=1},t}(),Ce=function(){function t(t){this.idGenerator=new Oe,this.currentStroke=new Bt,this.isLineMode=!1,this.inputStrokes=[],this.newPointsIndex=0,this.noop={add:Ie},this.output=this.noop,this.beginEndSink=t}return t.prototype.setDrawingAttributes=function(t){this.currentStroke.drawingAttributes=t},t.prototype.beginStroke=function(t){this.newPointsIndex=0,this.currentStroke.id=this.idGenerator.generate(),this.beginEndSink.onStrokeBegin(),this.output=this.currentStroke,this.output.add(this.isLineMode?this.getConstantPressurePoint(t):t)},t.prototype.addPoint=function(t){this.isLineMode&&1===this.currentStroke.points.length?this.output.add(this.getConstantPressurePoint(t)):this.isLineMode&&this.currentStroke.points.length>1?this.currentStroke.points[this.currentStroke.points.length-1]=this.getConstantPressurePoint(t):this.output.add(t)},t.prototype.endStroke=function(t){this.output!==this.noop&&(this.isLineMode&&this.currentStroke.points.length>1?this.currentStroke.points[this.currentStroke.points.length-1]=this.getConstantPressurePoint(t):this.output.add(t),this.inputStrokes.push([this.currentStroke,this.newPointsIndex]),this.cancel())},t.prototype.makeCurrentStrokeStraight=function(){var t=this.currentStroke.points.length;t>=2&&(this.linePressure=this.getAveragePressureAcrossStroke(this.currentStroke),0===this.linePressure&&(this.linePressure=.5),this.currentStroke.points.splice(1,t-2),this.currentStroke.points[0]=this.getConstantPressurePoint(this.currentStroke.points[0]),this.currentStroke.points[1]=this.getConstantPressurePoint(this.currentStroke.points[1]))},t.prototype.cancel=function(){this.output!==this.noop&&(this.output=this.noop,this.linePressure=void 0,this.currentStroke=new Bt,this.beginEndSink.onStrokeEnd())},t.prototype.streamCollectedStrokes=function(t){this.inputStrokes.forEach((function(e){t.add(e[0]),e[1]=e[0].points.length-1}))},t.prototype.streamCollectedStrokesNewPoints=function(t){this.inputStrokes.forEach((function(e){e[1]=jt(e[0],t,e[1])}))},t.prototype.resetCollectedStrokes=function(){this.inputStrokes=[]},t.prototype.streamCurrentStroke=function(t){this.newPointsIndex=jt(this.currentStroke,t,0)},t.prototype.streamCurrentStrokeNewPoints=function(t){this.newPointsIndex=jt(this.currentStroke,t,this.newPointsIndex)},t.prototype.getAveragePressureAcrossStroke=function(t){for(var e=0,n=0;n<t.points.length;n+=1)e+=t.points[n].pressure;return 0===e||0===t.points.length?0:e/t.points.length},t.prototype.getConstantPressurePoint=function(t){return void 0===this.linePressure&&(this.linePressure=0===t.pressure?.5:t.pressure),{x:t.x,y:t.y,pressure:this.linePressure,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timestamp}},t}();function Ae(t){var e=Dt();return t.streamPoints({add:function(t){!function(t,e){t.left=Math.min(t.left,e.x),t.right=Math.max(t.right,e.x),t.top=Math.min(t.top,e.y),t.bottom=Math.max(t.bottom,e.y)}(e,t)}}),e}var De=function(){function t(){this.strokes=[]}return t.prototype.add=function(t){this.strokes.push(t)},t.prototype.stream=function(t){this.strokes.forEach((function(e){t.add(e)}))},t}();function Re(t){var e=[];return t.stream({add:function(t){e.push(function(t){var e={id:t.id,drawingAttributes:t.drawingAttributes,x:[],y:[],pressure:[],tiltX:[],tiltY:[],timestamp:[]};return t.streamChannels({addPoint:function(t){e.x.push(t.x),e.y.push(t.y)},addPressure:function(t){e.pressure.push(t)},addTilt:function(t){e.tiltX.push(t.tiltX),e.tiltY.push(t.tiltY)},addTimestamp:function(t){e.timestamp.push(t)}}),JSON.stringify(e)}(t))}}),"["+e.join(",")+"]"}var Le=function(){function t(t){this.stroke=t}return t.prototype.getJSON=function(){var t=new De;return t.add(this.stroke),Re(t)},t.prototype.getBoundingBox=function(t,e){var n=Ae(this.stroke);return n.left+=t,n.right+=t,n.top+=e,n.bottom+=e,n},t}(),Ne=function(){function t(){this.transform=function(t){return t}}return t.prototype.beginStroke=function(t){this.output.beginStroke(this.transform(t))},t.prototype.addPoint=function(t){this.output.addPoint(this.transform(t))},t.prototype.endStroke=function(t){this.output.endStroke(this.transform(t))},t}();function Ue(t,e){return function(n){return{x:n.x+t,y:n.y+e,tiltX:n.tiltX,tiltY:n.tiltY,pressure:n.pressure,timestamp:n.timestamp}}}var He=function(){function t(t){this.scale=t}return t.prototype.add=function(t){var e,n,i,o=new Ne,r=Ae(t);o.transform=(e=r.left/this.scale-r.left,n=r.top/this.scale-r.top,i=this.scale,function(t){return{x:(t.x+e)*i,y:(t.y+n)*i,pressure:t.pressure,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timestamp}});var s=new Bt;s.id=t.id,s.drawingAttributes=t.drawingAttributes,C(o,new Zt,s),t.streamPath(o),this.output.add(s)},t}(),_e=function(){function t(t){var e=this;this.strokeSink={add:function(){},begin:function(){},end:function(){}},this.collector=new Ce({onStrokeBegin:function(){e.strokeBeginEndListener.onStrokeBegin()},onStrokeEnd:function(){e.strokeBeginEndListener.onStrokeEnd()}}),this.zoom=t}return t.prototype.updateZoom=function(t){this.zoom=t},t.prototype.collectChanges=function(t,e){e?(this.collector.streamCurrentStrokeNewPoints(t),this.collector.streamCollectedStrokesNewPoints(t)):(this.collector.streamCurrentStroke(t),this.collector.streamCollectedStrokes({add:function(e){e.stream(t)}}))},t.prototype.setStrokeSink=function(t){this.strokeSink=t},t.prototype.initializeDryStrokesCallback=function(){var t=this;this.strokeBeginEndListener.task=function(){t.strokeSink.begin();var e=new He(1/t.zoom);O(e,{add:function(e){t.strokeSink.add(new Le(e))}}),t.collector.streamCollectedStrokes(e),t.collector.resetCollectedStrokes(),t.strokeSink.end()}},t}(),We=function(){function t(t,e){var n=this;this.task=function(){},this.executeTask=function(){n.task(),n.isIEOrFF?requestAnimationFrame((function(){window.setTimeout((function(){n.renderer.clear()}),0)})):n.renderer.clear(),n.resetPendingTask()},this.renderer=t,this.idleTimeToDryInk=e,this.isIEOrFF=r()||s()}return t.prototype.onStrokeBegin=function(){this.renderer.strokeBeginEndListener.onStrokeBegin(),void 0!==this.timeoutTask&&this.resetPendingTask()},t.prototype.onStrokeEnd=function(){this.renderer.strokeBeginEndListener.onStrokeEnd(),this.timeoutTask=window.setTimeout(this.executeTask,this.idleTimeToDryInk)},t.prototype.dryAllStrokes=function(){this.executeTask(),this.resetPendingTask()},t.prototype.resetPendingTask=function(){window.clearTimeout(this.timeoutTask)},t}();var Xe=function(){function t(t,e,n,i,r,s,u,a){var h,c,p=this;this.toolType=0,this.wetCanvas=function(t,e){var n=T();return n.width=e.clientWidth,n.height=e.clientHeight,n.style.touchAction="none",n.style.pointerEvents="none",n.style.position="absolute",n.style.top="0",n.style.left="0",t.appendChild(n),I.info("Canvas created: width:"+n.width+" height:"+n.height),n}(t,e),this.inkMinutesMetric=new x(o,1),h=o,c=1,S||(new k(h,c),S=!0),this.targetElement=e,this.store=new _e(i),this.dryStore=r,this.dryStore.updateZoom(i),this.viewModelModifier=s,this.pipeline=new Jt(this.wetCanvas,n,this.store,r,this.wetCanvas,s,a,(function(){return p.getDrawingHaptics()})),this.renderer=new Me(this.wetCanvas,this.store,i),this.store.strokeBeginEndListener=new We(this.renderer,u),this.store.initializeDryStrokesCallback(),this.attributes=new P,this.color=new y,this.setColor("#e71224"),this.selectPen(),this.zoom=i}return t.prototype.startPipeline=function(){this.pipeline.activate(),this.inkMinutesMetric.activate(this.wetCanvas)},t.prototype.stopPipeline=function(){this.renderer.clear(),this.pipeline.deactivate(),this.setDarkenMixBlendMode(!1),this.inkMinutesMetric.deactivate()},t.prototype.enableTouchMouse=function(){a(this.wetCanvas),this.pipeline.deactivatePenOnly()},t.prototype.disableTouchMouse=function(){this.pipeline.activatePenOnly(),h(this.wetCanvas)},t.prototype.setColor=function(t){this.attributes.setColor(this.color.setHexRGB(t).build()),this.pipeline.injector.setDrawingAttributes(this.attributes.build())},t.prototype.setThickness=function(t){switch(this.toolType){case 0:var e=(n=t,Math.min(13.22835,.94488*Math.pow(2,n-1)));this.attributes.setWidth(e).setHeight(e);break;case 1:e=function(t){return 7.55906*t}(t);this.attributes.setWidth(e/2).setHeight(e)}var n;this.pipeline.injector.setDrawingAttributes(this.attributes.build())},t.prototype.selectPen=function(){this.attributes.setColor(this.color.build()).setTip("ellipse").setRasterOperation("copy").setWidth(3.77953).setHeight(3.77953),this.pipeline.injector.setDrawingAttributes(this.attributes.build()),this.pipeline.setDrawing(),this.toolType=0,this.renderer.setIncrementalRender(!0),this.setDarkenMixBlendMode(!1),this.inkMinutesMetric.start(w.Pen)},t.prototype.selectHighlighter=function(){this.attributes.setColor(this.color.build()).setTip("rectangle").setRasterOperation("mask").setWidth(11.3386).setHeight(22.6772),this.pipeline.injector.setDrawingAttributes(this.attributes.build()),this.pipeline.setDrawing(),this.toolType=1,this.renderer.setIncrementalRender(u()),this.setDarkenMixBlendMode(!0),this.inkMinutesMetric.start(w.Highlighter)},t.prototype.setStrokeSink=function(t){this.store.setStrokeSink(t)},t.prototype.updateCanvasDimensions=function(){this.wetCanvas.style.width=this.targetElement.clientWidth+"px",this.wetCanvas.style.height=this.targetElement.clientHeight+"px",this.renderer.updateCanvasContext(this.zoom,this.wetCanvas)},t.prototype.updateCanvasZoom=function(t){this.zoom=t,this.dryStore.updateZoom(t),this.renderer.updateCanvasContext(this.zoom,this.wetCanvas),this.store.updateZoom(t)},t.prototype.selectEraser=function(){this.pipeline.setErasing(),this.viewModelModifier.clearSelection(),this.setDarkenMixBlendMode(!1),this.inkMinutesMetric.start(w.Erase)},t.prototype.selectLasso=function(){this.attributes.setColor(this.color.build()).setTip("ellipse").setRasterOperation("copy").setWidth(3.77953).setHeight(3.77953),this.pipeline.injector.setDrawingAttributes(this.attributes.build()),this.pipeline.setLassoing(),this.setDarkenMixBlendMode(!1),this.inkMinutesMetric.start(w.Lasso)},t.prototype.dryAllStrokes=function(){this.store.strokeBeginEndListener.dryAllStrokes()},t.prototype.setDarkenMixBlendMode=function(t){null!==this.wetCanvas.parentElement&&this.wetCanvas.parentElement.style.setProperty("mix-blend-mode",t?"darken":"normal")},t.prototype.getDrawingHaptics=function(){return"rectangle"===this.attributes.build().tip?i.WAVEFORM_MARKER_CONTINUOUS:i.WAVEFORM_INK_CONTINUOUS},t}(),Ve=new(function(){function t(){}return t.prototype.createEditorInkCanvas=function(t,e,n,i,o,r,s,u){return new Xe(t,e,n,i,o,r,s,u)},t.prototype.setLogger=function(t){I=t},t.prototype.setActivityLogger=function(t){o=t},t}()),Ye={tiltX:0,tiltY:0},Fe=function(){function t(){this.id=0,this.drawingAttributes=g,this.points=[],this.pressures=[],this.tilts=[],this.timestamps=[]}return t.prototype.streamChannels=function(t){this.points.forEach((function(e){t.addPoint(e)})),this.pressures.forEach((function(e){t.addPressure(e)})),this.tilts.forEach((function(e){t.addTilt(e)})),this.timestamps.forEach((function(e){t.addTimestamp(e)}))},t.prototype.streamPoints=function(t){var e=this;this.points.forEach((function(n,i){t.add(e.getPoint(i))}))},t.prototype.streamPath=function(t){if(!(this.points.length<2)){t.beginStroke(this.getPoint(0));for(var e=1;e<this.points.length-1;e+=1)t.addPoint(this.getPoint(e));t.endStroke(this.getPoint(this.points.length-1))}},t.prototype.stream=function(t){t.setDrawingAttributes(this.drawingAttributes),this.streamPath(t)},t.prototype.addPoint=function(t){this.points.push(t)},t.prototype.addPressure=function(t){this.pressures.push(t)},t.prototype.addTilt=function(t){this.tilts.push(t)},t.prototype.addTimestamp=function(t){this.timestamps.push(t)},t.prototype.getPressure=function(t){return this.pressures.length>t?this.pressures[t]:.5},t.prototype.getTilt=function(t){return this.tilts.length>t?this.tilts[t]:Ye},t.prototype.getTimestamp=function(t){return this.timestamps.length>t?this.timestamps[t]:0},t.prototype.getPoint=function(t){return e=this.points[t],n=this.getPressure(t),i=this.getTilt(t),o=this.getTimestamp(t),{x:e.x,y:e.y,pressure:n,tiltX:i.tiltX,tiltY:i.tiltY,timestamp:o};var e,n,i,o},t}();function Be(t){return function(t){if(t.x.length!==t.y.length)throw new Error("X & Y don't match");if(0!==t.pressure.length&&t.pressure.length!==t.x.length)throw new Error("Pressure don't match X");if(t.tiltX.length!==t.tiltY.length)throw new Error("Tilt X & Y don't match");if(0!==t.tiltX.length&&t.tiltX.length!==t.x.length)throw new Error("Tilts don't match X.");if(0!==t.timestamp.length&&t.timestamp.length!==t.x.length)throw new Error("Timestamp don't match X")}(t),t.x.length===t.pressure.length&&t.x.length===t.tiltX.length&&t.x.length===t.timestamp.length?function(t){var e=new Bt;return e.drawingAttributes=t.drawingAttributes,e.id=t.id,t.x.forEach((function(n,i){e.add({x:n,y:t.y[i],pressure:t.pressure[i],tiltX:t.tiltX[i],tiltY:t.tiltY[i],timestamp:t.timestamp[i]})})),e}(t):function(t){var e=new Fe;return e.drawingAttributes=t.drawingAttributes,e.id=t.id,t.x.forEach((function(n,i){e.addPoint({x:n,y:t.y[i]})})),t.pressure.forEach((function(t){e.addPressure(t)})),t.tiltX.forEach((function(n,i){e.addTilt({tiltX:n,tiltY:t.tiltY[i]})})),t.timestamp.forEach((function(t){e.addTimestamp(t)})),e}(t)}function ze(t){var e=new De;return JSON.parse(t).forEach((function(t){e.add(Be(t))})),e}var je=function(){function t(t){this.threshold=t*t}return t.prototype.beginStroke=function(t){this.basePoint=t,this.midPoint=t,this.output.beginStroke(t)},t.prototype.addPoint=function(t){j(this.basePoint,t,this.midPoint)>this.threshold?(this.output.addPoint(this.midPoint),this.basePoint=this.midPoint,this.midPoint=t):(z(this.basePoint,t)<z(this.basePoint,this.midPoint)&&(this.output.addPoint(this.midPoint),this.basePoint=this.midPoint),this.midPoint=t)},t.prototype.endStroke=function(t){this.addPoint(t),this.output.endStroke(t)},t}(),qe=function(){function t(t){this.points="",this.svgPolyline=t}return t.prototype.setDrawingAttributes=function(t){this.svgPolyline.setAttribute("stroke-linecap","ellipse"===t.tip?"round":"square"),this.svgPolyline.setAttribute("stroke-width",""+2*t.width)},t.prototype.beginStroke=function(t){this.addPoint(t)},t.prototype.addPoint=function(t){this.points+=Math.round(t.x)+","+Math.round(t.y)+" "},t.prototype.endStroke=function(t){this.addPoint(t),this.svgPolyline.setAttribute("points",this.points),this.points=""},t}();function Ze(t){var e=0,n=Dt();return t.forEach((function(t){var i=Ae(t.stroke);Rt(n,i);var o=t.stroke.drawingAttributes;e=Math.max(e,o.width,o.height)})),{bounds:n,maxStrokeSize:e}}function Ke(t){if(0===t.length)return{svgHitTestOverlay:M(),padding:0};var e=Ze(t),n=e.bounds,i=e.maxStrokeSize,o=Math.ceil(2*i),r=Math.round(n.right-n.left),s=Math.round(n.bottom-n.top),u=r+2*o,a=s+2*o,h=M();return t.forEach((function(t){var e=E("polyline");h.setAttribute("width",""+u),h.setAttribute("height",""+a),e.setAttribute("stroke","black"),e.setAttribute("stroke-opacity","0.0"),e.setAttribute("fill","none"),h.appendChild(e);var i=new qe(e),o=new je(.7),r=new Ne;r.transform=Ue(-n.left,-n.top),C(o,r,i),i.setDrawingAttributes(t.stroke.drawingAttributes),t.stroke.streamPath(o)})),h.setAttribute("viewBox","-"+o+" -"+o+" "+u+" "+a),{svgHitTestOverlay:h,padding:o}}var Ge=function(){function t(t){this.modifier=new Qt,this.renderer=t,O(this.modifier,this.renderer)}return t.prototype.add=function(t){this.modifier.modifier=function(t){return new P(t).setWidth(t.width+4.5).setHeight(t.height+4.5).build()},t.stream(this.modifier),this.modifier.modifier=function(t){return new P(t).setColor(l).setEffect(v).build()},t.stream(this.modifier)},t}();function Je(t,e,n,i){if(0===e.length)return{imageData:"",width:0,height:0,padding:0,isHighlighter:!1};var o=Ze(e),r=o.bounds,s=o.maxStrokeSize,u=Math.ceil(2*s*n),a={left:r.left*n,top:r.top*n,right:r.right*n,bottom:r.bottom*n},h=Math.round(a.left),c=Math.round(a.top),p=Math.round(a.right)-h+2*u,d=Math.round(a.bottom)-c+2*u;t.width=p,t.height=d;var l=Ft(t,window.devicePixelRatio,p,d);return l.translate(u+a.left-h,u+a.top-c),l.scale(n,n),l.translate(-r.left,-r.top),function(t,e,n){if(e){var i=new Ge(new be(t,new Te));n.forEach((function(t){i.add(t.stroke)}))}else{var o=Ee(t);n.forEach((function(t){t.stroke.stream(o)}))}}(l,i,e),{imageData:t.toDataURL("image/png"),width:p,height:d,padding:u,isHighlighter:e.length>0&&"mask"===e[0].stroke.drawingAttributes.rasterOperation}}var Qe=function(){function t(){this.canvas=T()}return t.prototype.deserializeJSON=function(t){var e=[];try{return ze(t).stream({add:function(t){e.push(new Le(t))}}),e}catch(t){return I.info("Unable to deserialize JSON. Excepton: "+t),e}},t.prototype.rasterizeStrokeCollectionWithZoom=function(t,e,n){return I.info("rasterizeStrokeCollectionWithZoom strokeCount="+t.length+" zoom="+e+" isSelected="+n),Je(this.canvas,t,e,n)},t.prototype.generateStrokeCollectionHitTestElement=function(t){return Ke(t)},t.prototype.containsPencilInkContent=function(t){var e=!1;return t.forEach((function(t){2===t.stroke.drawingAttributes.effect.type&&(e=!0)})),e},t}(),$e=new(function(){function t(){}return t.prototype.createEditorInkStrokeRasterizer=function(){return new Qe},t}());function tn(t){var e=Dt();return t.stream({add:function(t){Rt(e,Ae(t))}}),e}function en(t,e){var n=new De,i=new Ne;i.transform=e;var o=new Zt;return t.stream({add:function(t){var e=new Bt;e.id=t.id,e.drawingAttributes=t.drawingAttributes,C(i,o,e),t.streamPath(i),n.add(e)}}),n}function nn(t,e){return en(t,function(t){return function(e){return{x:e.x*t,y:e.y*t,tiltX:e.tiltX,tiltY:e.tiltY,pressure:e.pressure,timestamp:e.timestamp}}}(e))}function on(t,e,n,i){return en(t,function(t,e,n){var i=n*Math.PI/180,o=Math.cos(i),r=Math.sin(i);return function(n){var i=n.x-t,s=n.y-e;return{x:i*o-s*r+t,y:i*r+s*o+e,tiltX:n.tiltX,tiltY:n.tiltY,pressure:n.pressure,timestamp:n.timestamp}}}(e,n,i))}function rn(t,e){if(0===e)return t;var n=tn(t);return on(t,(n.right-n.left)/2,(n.bottom-n.top)/2,e)}function sn(t,e,n){return en(t,Ue(e,n))}function un(t){var e=tn(t);return sn(t,-e.left,-e.top)}var an=function(){function t(t,e){this.zoom=1,this.inkObjectsMap=new Map,this.slideViewElement=t,this.slideViewportElement=e}return t.prototype.updateSlideElements=function(t,e){this.slideViewElement=t,this.slideViewportElement=e},t.prototype.registerInkWithStrokeCollection=function(t,e){if(!this.inkObjectsMap.has(e)){var n=new De;t.forEach((function(t){n.add(t.stroke)}));var i=un(n);this.inkObjectsMap.set(e,{json:Re(i),strokeCollection:nn(i,this.zoom),locationInSlideView:{x:Number.MAX_VALUE,y:Number.MAX_VALUE},rotation:0})}},t.prototype.unregisterInk=function(t){return this.inkObjectsMap.delete(t)},t.prototype.updateZoom=function(t){var e=this;if(this.zoom!==t){this.zoom=t;try{this.inkObjectsMap.forEach((function(t,n){e.inkObjectsMap.set(n,{json:t.json,strokeCollection:rn(nn(ze(t.json),e.zoom),t.rotation),locationInSlideView:t.locationInSlideView,rotation:t.rotation})}))}catch(t){I.info("Unable to deserialize JSON in updateZoom. Excepton: "+t)}}},t.prototype.updateInkSlideViewLocation=function(t,e,n,i,o){if(this.inkObjectsMap.has(t)){var r=this.inkObjectsMap.get(t);if(void 0!==r){if(void 0!==i&&i.length>0&&(i!==r.json||o!==r.rotation))try{var s=un(ze(i)),u=rn(nn(s,this.zoom),o);return void this.inkObjectsMap.set(t,{json:Re(s),strokeCollection:u,locationInSlideView:{x:e,y:n},rotation:o})}catch(t){return void I.info("Unable to deserialize JSON in updateInkSlideViewLocation. Excepton: "+t)}void 0!==i&&0!==i.length||I.info("Incoming JSON was undefined or of zero length!"),this.inkObjectsMap.set(t,{json:r.json,strokeCollection:r.strokeCollection,locationInSlideView:{x:e,y:n},rotation:r.rotation})}}},t.prototype.clearStore=function(){this.inkObjectsMap.clear()},t.prototype.generateHitTestData=function(){var t=new Map,e=this.calculateDistanceBetweenSlideviewAndFishbowl();return this.inkObjectsMap.forEach((function(n,i){var o=sn(n.strokeCollection,n.locationInSlideView.x+e.x,n.locationInSlideView.y+e.y);t.set(i,{strokeCollection:o,bounds:tn(o)})})),t},t.prototype.calculateDistanceBetweenSlideviewAndFishbowl=function(){return void 0!==this.slideViewElement&&void 0!==this.slideViewportElement?{x:this.slideViewElement.getBoundingClientRect().left-this.slideViewportElement.getBoundingClientRect().left,y:this.slideViewElement.getBoundingClientRect().top-this.slideViewportElement.getBoundingClientRect().top}:{x:0,y:0}},t}(),hn=new(function(){function t(){}return t.prototype.createEditorInkDryStore=function(t,e){return new an(t,e)},t}())}]);
//# sourceMappingURL=ink.js.map